{% extends 'base.html' %}
{% load static %}
{% load humanize %}


{% block title %}ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª{% endblock %}

{% block page_title %}ØªÙ‚Ø±ÙŠØ±  Ø§Ù„Ù…Ø³ØªØ§Ø¬Ø±ÙŠÙ† {% endblock %}


{% block extra_css %}
<link href="{% static 'css/tenants_reports.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="container">
        <!-- Ø±Ø£Ø³ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
        <div class="header">
            <h1>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ† ÙˆØ§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª</h1>
            <p class="date">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: {{ report_date|date:"Y-m-d" }}</p>
        </div>
        
        <!-- ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø« -->
        <div class="filters">
            <h3>ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø«</h3>
            <form method="get" action="">
                <div class="filter-row">
                    <div class="filter-item">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±:</label>
                        <input type="text" name="tenant_name" value="{{ filters.tenant_name }}" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…...">
                    </div>
                    <div class="filter-item">
                        <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</label>
                        <input type="text" name="location" value="{{ filters.location }}" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹...">
                    </div>
                    <div class="filter-item">
                        <label>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª:</label>
                        <select name="has_outstanding">
                            <option value="">Ø§Ù„ÙƒÙ„</option>
                            <option value="yes" {% if filters.has_outstanding == 'yes' %}selected{% endif %}>ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ­Ù‚Ø§Øª</option>
                            <option value="no" {% if filters.has_outstanding == 'no' %}selected{% endif %}>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ­Ù‚Ø§Øª</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <button type="submit">Ø¨Ø­Ø«</button>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        <div class="table-container">
            {% if report_data %}
            <table>
                <thead>
                    <tr>
                        <th>Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±</th>
                        <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                        <th>Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø³Ù†ÙˆÙŠ</th>
                        <th>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø±Ø¶</th>
                        <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                        <th>Ø§Ù„Ù…Ø³ØªØ­Ù‚</th>
                        <th>Ù…Ù† ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in report_data %}
                    {% if item.outstanding_amount > 0 %}
                    <tr class="{% cycle 'row-even' 'row-odd' %}">
                        <td>{{ item.tenant_id }}</td>
                        <td>{{ item.tenant_name }}</td>
                        <td>{{ item.location|default:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯" }}</td>
                        <td class="amount">{{ item.annual_rent|floatformat:2|intcomma }}</td>
                        <td>{{ item.all_unit_numbers_str|default:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯" }}</td>
                        <td>{{ item.tenant_phone|default:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯" }}</td>
                        <td class="{% if item.outstanding_amount > 0 %}overdue{% else %}paid{% endif %}">
                            {{ item.outstanding_amount|floatformat:2|intcomma }}
                        </td>
                        <td>{{ item.due_period_from|date:"Y-m-d"|default:"-" }}</td>
                        <td>{{ item.due_period_to|date:"Y-m-d"|default:"-" }}</td>
                        <td>
                            <div class="actions">
                                <a href="{% url 'rent:contract_detail' item.contract_id %}" class="btn btn-info">ØªÙØ§ØµÙŠÙ„</a>
                                {% if item.outstanding_amount > 0 and perms.rent.add_receipt %}
                                <a href="{% url 'rent:receipt_create' %}?contract={{ item.contract_id }}" class="btn btn-warning">Ø³Ø¯Ø§Ø¯</a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endif%}
                    {% endfor %}

                </tbody>
                <tfoot>
                    <tr style="background: #f8f9fa; font-weight: bold;">
                        <td colspan="6" style="text-align: left; padding-right: 15px;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</td>
                        <td class="amount">{{ total_outstanding|floatformat:2|intcomma  }}</td>
                        <td colspan="3"></td>
                    </tr>
                </tfoot>
            </table>
            {% else %}
            <div class="no-data">
                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶</p>
            </div>
            {% endif %}
        </div>
        
        <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="summary">
            <div class="summary-card">
                <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù‚ÙˆØ¯</h3>
                <div class="value">{{ report_data|length }}</div>
            </div>
            <div class="summary-card warning">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª</h3>
                <div class="value">{{ total_outstanding|floatformat:2|intcomma  }} Ø±ÙŠØ§Ù„</div>
            </div>
            <div class="summary-card success">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø³Ù†ÙˆÙŠ</h3>
                <div class="value">{{ total_annual_rent|floatformat:2|intcomma  }} Ø±ÙŠØ§Ù„</div>
            </div>
        </div>
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ± -->
        <div class="export-buttons">
            {% if perms.rent.export_reports %}
            <a href="{% url 'rent:export_tenants_excel' %}">ğŸ“Š ØªØµØ¯ÙŠØ± Excel</a>
            <a href="{% url 'rent:export_tenants_pdf' %}">ğŸ“„ ØªØµØ¯ÙŠØ± PDF</a>
            {% endif %}
            <a href="#" onclick="window.print(); return false;">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</a>
        </div>


    </div>
    
    <style>
        /* Ø£Ù„ÙˆØ§Ù† Ù…ØªÙ†Ø§ÙˆØ¨Ø© Ù„Ù„ØµÙÙˆÙ */
        .row-even {
            background-color: #ffffff;
        }
        .row-odd {
            background-color: #f8f9fa;
        }
        .row-even:hover, .row-odd:hover {
            background-color: #e9ecef;
        }
    </style>
{% endblock %}