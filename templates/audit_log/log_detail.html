{% extends 'base.html' %}
{% load static %}

{% block title %}تفاصيل السجل #{{ log.pk }}{% endblock %}

{% block page_title %}
    <div class="d-flex align-items-center">
        <i class="fas fa-info-circle text-primary me-2"></i>
        تفاصيل السجل #{{ log.pk }}
    </div>
{% endblock %}

{% block page_actions %}
<a href="{% url 'audit_log:logs_list' %}" class="btn btn-secondary">
    <i class="fas fa-arrow-right"></i> رجوع
</a>
{% endblock %}

{% block content %}
<div class="row g-4">
    <div class="col-lg-6">
        <!-- معلومات أساسية -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0"><i class="fas fa-info-circle text-primary"></i> معلومات العملية</h5>
            </div>
            <div class="card-body">
                <table class="table table-borderless">
                    <tr>
                        <th style="width: 30%">العملية:</th>
                        <td>
                            {% if log.action == 'create' %}
                                <span class="badge bg-success">إنشاء</span>
                            {% elif log.action == 'update' %}
                                <span class="badge bg-warning text-dark">تعديل</span>
                            {% elif log.action == 'delete' %}
                                <span class="badge bg-danger">حذف</span>
                            {% elif log.action == 'login' %}
                                <span class="badge bg-info">دخول</span>
                            {% elif log.action == 'logout' %}
                                <span class="badge bg-secondary">خروج</span>
                            {% elif log.action == 'login_failed' %}
                                <span class="badge bg-danger">دخول فاشل</span>
                            {% else %}
                                <span class="badge bg-dark">{{ log.action }}</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>التاريخ:</th>
                        <td>{{ log.created_at|date:"Y/m/d H:i:s" }}</td>
                    </tr>
                    <tr>
                        <th>المستخدم:</th>
                        <td>{{ log.user_name }}</td>
                    </tr>
                    <tr>
                        <th>النموذج:</th>
                        <td>{{ log.model_name }}</td>
                    </tr>
                    <tr>
                        <th>الوصف:</th>
                        <td>{{ log.object_repr }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <!-- معلومات الطلب -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0"><i class="fas fa-globe text-info"></i> معلومات الطلب</h5>
            </div>
            <div class="card-body">
                <table class="table table-borderless">
                    <tr>
                        <th style="width: 30%">المسار:</th>
                        <td><code>{{ log.request_path|default:"-" }}</code></td>
                    </tr>
                    <tr>
                        <th>الطريقة:</th>
                        <td><span class="badge bg-primary">{{ log.request_method|default:"-" }}</span></td>
                    </tr>
                    <tr>
                        <th>IP:</th>
                        <td>{{ log.ip_address|default:"-" }}</td>
                    </tr>
                    <tr>
                        <th>المتصفح:</th>
                        <td><small>{{ log.user_agent|default:"-"|truncatechars:80 }}</small></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <!-- التغييرات -->
    {% if log.changes %}
    <div class="col-12">
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0"><i class="fas fa-exchange-alt text-warning"></i> التغييرات</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>الحقل</th>
                                <th>القيمة القديمة</th>
                                <th>القيمة الجديدة</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for field, values in log.changes.items %}
                            <tr>
                                <td><strong>{{ field }}</strong></td>
                                <td class="text-danger">{{ values.old|default:"-" }}</td>
                                <td class="text-success">{{ values.new|default:"-" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- القيم القديمة -->
    {% if log.old_values %}
    <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0"><i class="fas fa-history text-danger"></i> القيم القديمة</h5>
            </div>
            <div class="card-body">
                <pre style="direction: ltr; font-size: 12px; max-height: 300px; overflow-y: auto;">{{ log.old_values|pprint }}</pre>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- القيم الجديدة -->
    {% if log.new_values %}
    <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0"><i class="fas fa-check-circle text-success"></i> القيم الجديدة</h5>
            </div>
            <div class="card-body">
                <pre style="direction: ltr; font-size: 12px; max-height: 300px; overflow-y: auto;">{{ log.new_values|pprint }}</pre>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
