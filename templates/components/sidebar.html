{% load static %}

<!-- Sidebar -->
<nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
    <div class="position-sticky pt-3">
        <ul class="nav flex-column">
            <!-- Dashboard -->
            <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}" 
                   href="{% url 'rent:dashboard' %}">
                    <i class="fas fa-home me-2"></i>
                    <span>الرئيسية</span>
                </a>
            </li>
            
            <!-- Properties Section -->
            {% if user.is_superuser or perms.rent.view_land %}
            <li class="nav-item">
                <a class="nav-link {% if 'land' in request.resolver_match.url_name or 'building' in request.resolver_match.url_name or 'unit' in request.resolver_match.url_name %}active{% endif %}" 
                   data-bs-toggle="collapse" 
                   href="#propertiesMenu" 
                   role="button" 
                   aria-expanded="false" 
                   aria-controls="propertiesMenu">
                    <i class="fas fa-building me-2"></i>
                    <span>العقارات</span>
                    <i class="fas fa-chevron-down float-start collapse-icon"></i>
                </a>
                <div class="collapse submenu" id="propertiesMenu">
                    <ul class="nav flex-column pe-3">
                        <li class="nav-item">
                            <a class="nav-link {% if 'land' in request.resolver_match.url_name %}active{% endif %}" 
                               href="{% url 'rent:land_list' %}">
                                <i class="fas fa-map me-2"></i>
                                <span>الأراضي</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'building' in request.resolver_match.url_name %}active{% endif %}" 
                               href="{% url 'rent:building_list' %}">
                                <i class="fas fa-building me-2"></i>
                                <span>المباني</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'unit' in request.resolver_match.url_name %}active{% endif %}" 
                               href="{% url 'rent:unit_list' %}">
                                <i class="fas fa-door-open me-2"></i>
                                <span>الوحدات</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            {% endif %}
            
            <!-- Tenants -->
            {% if user.is_superuser or perms.rent.view_tenant %}
            <li class="nav-item">
                <a class="nav-link {% if 'tenant' in request.resolver_match.url_name %}active{% endif %}" 
                   href="{% url 'rent:tenant_list' %}">
                    <i class="fas fa-users me-2"></i>
                    <span>المستأجرين</span>
                </a>
            </li>
            {% endif %}
            
            <!-- Contracts Section -->
            {% if user.is_superuser or perms.rent.view_contract %}
            <li class="nav-item">
                <!-- Parent link (العنصر الرئيسي) -->
                <a class="nav-link {% if 'contract' in request.resolver_match.url_name or 'modification' in request.resolver_match.url_name %}active{% endif %}"
                   data-bs-toggle="collapse"
                   href="#contractsMenu"
                   role="button"
                   aria-expanded="false"
                   aria-controls="contractsMenu">
                    <i class="fas fa-file-contract me-2"></i>
                    <span>العقود</span>
                    <i class="fas fa-chevron-down float-start collapse-icon"></i>
                </a>

                <!-- Submenu -->
                <div class="collapse submenu" id="contractsMenu">
                    <ul class="nav flex-column pe-3">
                        <!-- Contracts list -->
                        <li class="nav-item">
                            <a class="nav-link {% if 'contract' in request.resolver_match.url_name and 'modification' not in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'rent:contract_list' %}">
                                <i class="fas fa-file-signature me-2"></i>
                                <span>قائمة العقود</span>
                            </a>
                        </li>

                        <!-- Modifications list -->
                        <li class="nav-item">
                            <a class="nav-link {% if 'modification' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'rent:modification_list' %}">
                                <i class="fas fa-file-pen me-2"></i>
                                <span>تعديلات العقود</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            {% endif %}  
            <!-- ⬆️ هذا هو الـ endif الناقص للـ Contracts Section -->

        <!-- Payments -->
            {% if user.is_superuser or perms.rent.view_receipt %}
            <li class="nav-item">
                <a class="nav-link {% if 'receipt' in request.resolver_match.url_name %}active{% endif %}" 
                   href="{% url 'rent:receipt_list' %}">
                    <i class="fas fa-receipt me-2"></i>
                    <span>الدفعات</span>
                </a>
            </li>
            {% endif %}


            <!-- Reports Section -->
            {% if user.is_superuser or perms.rent.view_reports %}
            <li class="nav-item">
                <a class="nav-link {% if 'report' in request.resolver_match.url_name %}active{% endif %}" 
                   data-bs-toggle="collapse" 
                   href="#reportsMenu" 
                   role="button" 
                   aria-expanded="false" 
                   aria-controls="reportsMenu">
                    <i class="fas fa-chart-bar me-2"></i>
                    <span>التقارير</span>
                    <i class="fas fa-chevron-down float-start collapse-icon"></i>
                </a>
                <div class="collapse submenu" id="reportsMenu">
                    <ul class="nav flex-column pe-3">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'rent:report_active_contracts' %}">
                                <i class="fas fa-file-contract me-2"></i>
                                <span>العقود النشطة</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'rent:report_rep' %}">
                                <i class="fas fa-clock me-2"></i>
                                <span>تقرير المستأجرين المستحقين السداد</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'rent:report_contracts_expiring' %}">
                                <i class="fas fa-calendar-times me-2"></i>
                                <span>العقود المنتهية</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'rent:report_occupancy' %}">
                                <i class="fas fa-chart-pie me-2"></i>
                                <span>معدل الإشغال</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'rent:report_revenue' %}">
                                <i class="fas fa-money-bill-wave me-2"></i>
                                <span>الإيرادات</span>
                            </a>
                        </li>


                    </ul>
                </div>
            </li>
            {% endif %}

            <!-- سجل التدقيق -->
            {% if user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if 'audit' in request.path %}active{% endif %}"
                   data-bs-toggle="collapse"
                   href="#auditMenu"
                   role="button"
                   aria-expanded="false"
                   aria-controls="auditMenu">
                    <i class="fas fa-shield-alt me-2"></i>
                    <span>سجل التدقيق</span>
                    <i class="fas fa-chevron-down float-start collapse-icon"></i>
                </a>
                <div class="collapse submenu" id="auditMenu">
                    <ul class="nav flex-column pe-3">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'audit_log:dashboard' %}">
                                <i class="fas fa-tachometer-alt me-2"></i>
                                <span>لوحة التدقيق</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'audit_log:logs_list' %}">
                                <i class="fas fa-list me-2"></i>
                                <span>سجل العمليات</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            {% endif %}

            <!-- إدارة المستخدمين -->
            {% if user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if 'auth' in request.path %}active{% endif %}"
                   data-bs-toggle="collapse"
                   href="#usersMenu"
                   role="button"
                   aria-expanded="false"
                   aria-controls="usersMenu">
                    <i class="fas fa-user-cog me-2"></i>
                    <span>إدارة المستخدمين</span>
                    <i class="fas fa-chevron-down float-start collapse-icon"></i>
                </a>
                <div class="collapse submenu" id="usersMenu">
                    <ul class="nav flex-column pe-3">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'auth_app:user-list' %}">
                                <i class="fas fa-users me-2"></i>
                                <span>قائمة المستخدمين</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'auth_app:register' %}">
                                <i class="fas fa-user-plus me-2"></i>
                                <span>إضافة مستخدم</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            {% endif %}
        </ul>
    </div>
</nav>
